<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <title>miniGPT</title>
</head>
<body>
    <div class="container">
        <h1>miniGPT <span class="sub-text">powered by Zephyr-7B</span></h1>
        <div id="chat-container"></div>
        <div id="input-container">
            <input type="text" id="user-input" placeholder="Ask something..." onkeydown="handleKeyPress(event)">
            <button id="send-button" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <button id="modify-key-button" onclick="showKeyPrompt()" style="position: fixed; top: 20px; right: 20px; background: none; border: none; cursor: pointer;">
        <img src="https://i.imgur.com/56C5d5r.png" alt="Modify Key" style="width: 25px; height: 25px;">
    </button>

    <div id="key-prompt">
        <div class="modal-content">
            <h2>API Key Required</h2>
            <p>Get your Hugging Face API key from <a href="https://huggingface.co/settings/tokens" target="_blank" style="color: #fff;">here</a>.</p>
            <input type="text" id="key-input" placeholder="Paste your API key here">
            <button onclick="saveApiKey()">Submit Key</button>
        </div>
    </div>

    <script>
        let conversations = [];
        let apiKey = localStorage.getItem('hfApiKey');

        if (!apiKey) {
            document.getElementById('key-prompt').style.display = 'flex';
        }

        function showKeyPrompt() {
            document.getElementById('key-prompt').style.display = 'flex';
        }

        function saveApiKey() {
            apiKey = document.getElementById('key-input').value.trim();
            if (apiKey) {
                localStorage.setItem('hfApiKey', apiKey);
                document.getElementById('key-prompt').style.display = 'none';
            } else {
                alert('Please provide a valid API key!');
            }
        }

        async function fetchZephyrResponse(prompt) {
            const url = "https://api-inference.huggingface.co/models/HuggingFaceH4/zephyr-7b-beta";
            const response = await fetch(url, {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${apiKey}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ inputs: prompt })
            });
            if (!response.ok) return "Error: " + response.statusText;
            const data = await response.json();
            return data[0]?.generated_text || "Error: No response";
        }

        function sendMessage() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            if (!message) return;

            if (!apiKey) {
                document.getElementById('key-prompt').style.display = 'flex';
                return;
            }

            appendMessage(message, 'user');
            input.value = '';

            fetchZephyrResponse(message).then(response => {
                appendMessage(response, 'bot');
            });
        }

        function appendMessage(text, sender) {
            const chatContainer = document.getElementById('chat-container');
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender);
            messageDiv.innerText = text;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function handleKeyPress(event) {
            if (event.key === "Enter") {
                sendMessage();
            }
        }
    </script>
</body>
</html>
